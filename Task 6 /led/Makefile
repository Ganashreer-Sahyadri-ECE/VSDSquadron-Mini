TOP = led_blink
SRC = led_blink.v
PCF = led_blink.pcf
BIN = $(TOP).bin
DEVICE = hx1k
PACKAGE = tq144
YOSYS = yosys
NEXTPNR = nextpnr-ice40
ICEPACK = icepack
PROG = iceprog

$(BIN): $(SRC) $(PCF)
	@echo "üîß Running Yosys synthesis..."
	$(YOSYS) -p "synth_ice40 -top $(TOP) -json $(TOP).json" $(SRC)
	@echo "üìê Running NextPNR place and route..."
	$(NEXTPNR) --$(DEVICE) --package $(PACKAGE) --pcf $(PCF) --json $(TOP).json --asc $(TOP).asc
	@echo "üì¶ Packing bitstream..."
	$(ICEPACK) $(TOP).asc $(BIN)

flash: $(BIN)
	@echo "‚ö° Flashing to FPGA..."
	$(PROG) $(BIN)

clean:
	rm -f *.json *.asc *.bin

.PHONY: clean flash
